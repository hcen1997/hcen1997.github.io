---
layout: post
---
# 2020年使用springboot的mybatis项目解析
在一个springboot项目, 使用mybatis会引入4个包.
可以分成3类,Mybatis,Mybatis-spring, Mybatis-springboot.  
Mybatis是数据持久化框架, 改善jdbc连接方式.  
Mybatis-spring 使用spring ioc方式管理Mybatis对象.  
Mybatis-spring-boot使用约定和默认配置的方式减少配置项
---

## Mybatis解析
### 架构
* 用户层: 
  1. CRUD映射的xml,接口  
  2. 配置文件
* 核心功能层: (java语句转换为sql并返回java结果)
  1. java函数参数处理(参数映射)
  2. sql解析
  3. sql执行
  4. 结果映射
* 支持层: 
  1. 配置加载
  2. 连接管理
  3. 事务
  4. 缓存
  
  
### 核心包
* org.apache.ibatis.session
  * 
org.apache.ibatis.mapping
org.apache.ibatis.type
org.apache.ibatis.executor
org.apache.ibatis.binding


### 类详细解析
* SqlSession 存储即中心  
  1. commit() crud() rollback()
  2. getConnection()  getConfiguration()
  3. 升级 getMapper()
  * 使用方式  use mybatis.jar
    ```java
    try (SqlSession session = sqlSessionFactory
            .openSession()) {
      Blog blog = (Blog) session.selectOne(
         "org.mybatis.example.BlogMapper.selectBlog", 
         101);
    }
    ```
    ```java
    try (SqlSession session = sqlSessionFactory
            .openSession()) {
      BlogMapper mapper = session.getMapper(
            BlogMapper.class);
      Blog blog = mapper.selectBlog(101);
    }
    ```
* todo: executor

* todo: mapperStatment

* todo: type handler

* todo: what is binding

### diff
* Unlike ORM frameworks, MyBatis does not map Java objects to database tables 
but Java methods to SQL statements.   
* Other persistence frameworks such as Hibernate allow the creation 
of an object model (in Java, say) by the user, and create and maintain
 the relational database automatically. iBATIS takes the reverse 
 approach: the developer starts with a SQL database and iBATIS 
 automates the creation of the Java objects. Both approaches have 
 advantages, and iBATIS is a good choice when the developer does not
  have full control over the SQL database schema. For example, 
  an application may need to access an existing SQL database used
   by other software, or access a new database whose schema is not
    fully under the application developer's control, such as when
     a specialized database design team has created the schema and
      carefully optimized it for high performance  a

### mybatis spring
MyBatis integrates with Spring Framework and Google Guice. This feature allows 
one to build business code free of dependencies.

This module allows MyBatis to participate in Spring transactions. It will also 
build MyBatis mappers and sessions and inject them into other beans
#### example
```xml
<bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean">
    <property name="dataSource" ref="dataSource" />
</bean>

<bean id="blogMapper" class="org.mybatis.spring.mapper.MapperFactoryBean">
    <property name="sqlSessionFactory" ref="sqlSessionFactory" />
    <property name="mapperInterface" value="org.mybatis.example.BlogMapper" />
</bean>

<bean id="blogService" class="org.mybatis.example.BlogServiceImpl">
    <property name="blogMapper" ref="blogMapper" />
</bean>
```
Calling MyBatis is now just calling a bean
```java
public class BlogService {

    private BlogMapper blogMapper;

    public void setBlogMapper(BlogMapper blogMapper) {
        this.blogMapper = blogMapper;
    }

    public void doSomethingWithABlog(int blogId) {
        Blog blog = blogMapper.selectBlog(blogId);
        ...
    }
}
```


### mybatis spring boot
This feature allows one to build business code free of configuration.

### MyBatis Generator
MyBatis provides a code generator.
generate MyBatis artifacts needed to perform CRUD operations.

### history
mybatis is a fork of ibatis 3, in 2010. ibatis is stared in 2002.
java 1.5 is released in 2004, spring 3.0 is in 2009


### 参考

mybatis总结: https://www.cnblogs.com/cxuanBlog/p/12248536.html  
美团异常实例: https://tech.meituan.com/2020/06/18/inf-bom-mybatis.html  
mybatis文档: https://mybatis.org/mybatis-3/zh/getting-started.html  
mybatis spring 文档: http://mybatis.org/spring/zh/getting-started.html  
mybatis springboot 文档: http://mybatis.org/spring-boot-starter/mybatis-spring-boot-autoconfigure/index.html  
wiki: en.wikipedia.org

### zhishidian
* dao is jdbc(mybatis session)(maybe not...) + mapper
* mapper is mapper


### more
what is j2ee? what is entreprice need for technology?
I think answer is in books.
Expert One-on-One J2EE design and development.
Expert One-on-One J2EE Development without EJB 